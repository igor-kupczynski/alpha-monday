# Alpha Monday - Low Level Design: CI (GitHub Actions)

Date: 2026-01-30
Status: draft

## Goals
- Run the test suite on every push and pull request.
- Mirror local DB defaults with a disposable Postgres service.
- Keep CI minimal and fast.
- Build and push container images when a release tag is created.

## Non-goals (v1)
- Linting, static analysis, or formatting checks.
- Multi-version Go matrix testing.
- Automatic deployments to hosted environments.

## Decision
Use two GitHub Actions workflows:
- `ci.yml` for lint + test with Postgres service container.
- `images.yml` for building/pushing tagged API and worker images.

## Workflow
- Triggers: `push`, `pull_request`.
- Runner: `ubuntu-latest`.
- Services: `postgres:16-alpine` with health check.
- Env: `DATABASE_URL=postgres://alpha:alpha@localhost:5432/alpha_monday?sslmode=disable`.

## Steps
1. Checkout repository.
2. Set up Go using `go-version-file: go.mod` (Go 1.25.6) with caching.
3. Install `staticcheck`.
4. Run `make lint`.
5. Run `go test ./...`.

## Image Build Workflow
- Triggers: tag push (`v*`) or `workflow_dispatch`.
- Builds `Dockerfile.api` and `Dockerfile.worker` for linux/amd64.
- Pushes tags to the configured registry namespace.
- Uses GitHub secrets: `REGISTRY`, `REGISTRY_NAMESPACE`, `REGISTRY_USERNAME`, `REGISTRY_PASSWORD`.

## Notes
- CI does not invoke `docker compose` or local scripts.
- The service container exposes Postgres on localhost:5432 for the test suite.
- Local testing should use `make test`, which brings up the DB via docker compose.
- Image builds only publish tagged images; deployments remain manual.
